def send(item: T)(using Async): Unit =
  if closed.get() then throw CancellationException()
  val sent = Promise[Unit]()
  box.put((item, sent))
  sendItem(readers.send(_))
  sent.future.value

// 7
// 1.1,1.2|ts_unknown
// 1.3,1.5|ts_keyword_function
// 1.6,1.6|ts_unknown
// 1.7,1.10|ts_method
// 1.11,1.11|ts_punctuation_bracket
// 1.12,1.17|ts_unknown
// 1.18,1.18|ts_type
// 1.19,1.19|ts_punctuation_bracket
// 1.20,1.20|ts_punctuation_bracket
// 1.21,1.25|ts_keyword
// 1.26,1.26|ts_unknown
// 1.27,1.31|ts_type
// 1.32,1.32|ts_punctuation_bracket
// 1.33,1.34|ts_unknown
// 1.35,1.38|ts_type
// 1.39,2.4|ts_unknown
// 2.5,2.6|ts_conditional
// 2.7,2.13|ts_unknown
// 2.14,2.14|ts_punctuation_delimiter
// 2.15,2.17|ts_method_call
// 2.18,2.18|ts_punctuation_bracket
// 2.19,2.19|ts_punctuation_bracket
// 2.20,2.20|ts_unknown
// 2.21,2.24|ts_conditional
// 2.25,2.31|ts_unknown
// 2.32,2.52|ts_function_call
// 2.53,2.53|ts_punctuation_bracket
// 2.54,2.54|ts_punctuation_bracket
// 2.55,3.4|ts_unknown
// 3.5,3.7|ts_keyword
// 3.8,3.8|ts_unknown
// 3.9,3.12|ts_variable
// 3.13,3.15|ts_unknown
// 3.16,3.22|ts_function_call
// 3.23,3.23|ts_punctuation_bracket
// 3.24,3.27|ts_type
// 3.28,3.28|ts_punctuation_bracket
// 3.29,3.29|ts_punctuation_bracket
// 3.30,3.30|ts_punctuation_bracket
// 3.31,4.7|ts_unknown
// 4.8,4.8|ts_punctuation_delimiter
// 4.9,4.11|ts_method_call
// 4.12,4.12|ts_punctuation_bracket
// 4.13,4.13|ts_punctuation_bracket
// 4.14,4.17|ts_unknown
// 4.18,4.18|ts_punctuation_delimiter
// 4.19,4.23|ts_unknown
// 4.24,4.24|ts_punctuation_bracket
// 4.25,4.25|ts_punctuation_bracket
// 4.26,5.4|ts_unknown
// 5.5,5.12|ts_function_call
// 5.13,5.13|ts_punctuation_bracket
// 5.14,5.20|ts_unknown
// 5.21,5.21|ts_punctuation_delimiter
// 5.22,5.25|ts_method
// 5.26,5.26|ts_punctuation_bracket
// 5.27,5.27|ts_unknown
// 5.28,5.28|ts_punctuation_bracket
// 5.29,5.29|ts_punctuation_bracket
// 5.30,6.8|ts_unknown
// 6.9,6.9|ts_punctuation_delimiter
// 6.10,6.15|ts_property
// 6.16,6.16|ts_punctuation_delimiter
// 6.17,6.21|ts_property
// 6.22,8.1|ts_unknown
